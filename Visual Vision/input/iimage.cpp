#include "iimage.h"

/*****************************************************************************
 *
 *****************************************************************************/
IImage::IImage(QObject* parent) : Input(parent)
{
    isloaded = false;
}

/*****************************************************************************
 *
 *****************************************************************************/
int IImage::getNumFrames()
{
    if (isloaded)
        return 1;
    else
        return 0;
}

/*****************************************************************************
 *
 *****************************************************************************/
QVector<Data*> IImage::getNextFrame()
{
    DImage3* d = new DImage3();
    d->setImage(img);

    QVector<Data*> ans;
    ans.push_back(d);

    return ans;
}

/*****************************************************************************
 *
 *****************************************************************************/
QString IImage::getName()
{
    return QString("Image");
}

/*****************************************************************************
 *
 *****************************************************************************/
QString IImage::getCaption()
{
    return QString("Image");
}

/*****************************************************************************
 *
 *****************************************************************************/
QVector<DatInfo> IImage::getOutputTypes()
{
    QVector<DatInfo> ans;

    ans.push_back(DatInfo(IMAGE3, "Image"));

    return ans;
}

/*****************************************************************************
 *
 *****************************************************************************/
QVector<Data*> IImage::getCurrentFrame()
{
    DImage3* d = new DImage3();
    d->setImage(img);

    QVector<Data*> ans;
    ans.push_back(d);

    return ans;
}

/*****************************************************************************
 *
 *****************************************************************************/
void IImage::setFrameNum(int framenum)
{

}

/*****************************************************************************
 *
 *****************************************************************************/
void IImage::showConfig()
{
    config.exec();

    if (config.getOkClicked())
    {
        file = config.getFileName();
        img = imread(file.toStdString());
        if (img.cols > 0 && img.rows > 0)
            isloaded = true;
    }
}

/*****************************************************************************
 *
 *****************************************************************************/
void IImage::reset()
{

}

/*****************************************************************************
 *
 *****************************************************************************/
QMap<QString, QVariant> IImage::getData()
{
    QMap<QString, QVariant> ans;

    ans.insert("Name", QVariant(getName()));
    ans.insert("File", QVariant(config.getFileName()));

    return ans;
}

/*****************************************************************************
 *
 *****************************************************************************/
void IImage::setData(QMap<QString, QVariant> data)
{
    if (data.contains("File"))
    {
        config.setFileName(data["File"].toString());
        img = imread(file.toStdString());
        if (img.cols > 0 && img.rows > 0)
            isloaded = true;
    }
}

/*****************************************************************************
 *
 *****************************************************************************/
void IImage::reloadImage()
{

}


static InputFactory<IImage> iImage;
